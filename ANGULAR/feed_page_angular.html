<!DOCTYPE html>
<html lang="en">

<head>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.2/angular.min.js"></script>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="../CSS/main.css" />
  <link href="http://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet"
    id="bootstrap-css" />
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
    integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous" />

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
  <title>Feed</title>
  <style>
    body {
      background-color: #eeeeee;
    }

    .h7 {
      font-size: 0.8rem;
    }

    .gedf-wrapper {
      margin-top: 0.97rem;
    }

    .card-image {
      overflow: hidden;
    }

    .feed-image {
      max-width: 100%;
      height: auto;
    }

    .column-main {
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    @media (min-width: 992px) {
      .gedf-main {
        padding-left: 4rem;
        padding-right: 4rem;
      }

      .gedf-card {
        margin-bottom: 2.77rem;
      }
    }

    /**Reset Bootstrap*/
    .dropdown-toggle::after {
      content: none;
      display: none;
    }
  </style>
</head>

<body ng-app="feedApp">
  <script>
    let isNavOpen = false;
    function nav() {
      if (isNavOpen) {
        document.getElementById("top_drawer").style.transform =
          "translate(0px, -100%)";
        isNavOpen = false;
      } else {
        document.getElementById("top_drawer").style.transform =
          "translate(0px, 0px)";
        isNavOpen = true;
      }
    }
  </script>

  <ul class="nav_bar_ul">
    <li class="nav_item">
      <a href="index.html"><span class="nav_logo_item">TalentForage</span></a>
    </li>
    <li class="nav_item_right">
      <a href="profile_page.html"><i class="fa fa-user"></i></a>
      <a href="about.asp"><i class="fa fa-gear"></i></a>
      <a href="about.asp"><i class="fa fa-sign-out"></i></a>
    </li>
    <li class="nav_item_right right_item">
      <a onclick="nav()"><i class="fa fa fa-bars"></i></a>
    </li>
  </ul>

  <div id="top_drawer">
    <ul>
      <li class="drawer_list_item">
        <a href="about.asp" class="drawer_item"><i class="fa fa-user drawer_icon"></i><span>Profile</span></a>
      </li>
      <li class="drawer_list_item">
        <a href="about.asp" class="drawer_item"><i class="fa fa-gear drawer_icon"></i><span>Settings</span></a>
      </li>
      <li class="drawer_list_item">
        <a href="about.asp" class="drawer_item"><i class="fa fa-sign-out drawer_icon"></i><span>Sign Out</span></a>
      </li>
    </ul>
  </div>

  <nav class="navbar navbar-light bg-white"></nav>

  <div style="margin-top: 80px">
    <div style="margin: 45px">
      <div class="card">
        <div class="card-body">
          <div class="h5">@soorya_s_rajan</div>
          <div class="h7 text-muted">Fullname : Soorya S Rajan</div>
          <div class="h7">
            Developer of web applications, JavaScript, PHP, Java, Python,
            Ruby, Java, Node.js, etc.
          </div>
        </div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item">
            <div class="h6 text-muted">Followers</div>
            <div class="h5">127</div>
          </li>
          <li class="list-group-item">
            <div class="h6 text-muted">Posts</div>
            <div class="h5">12</div>
          </li>
          <li class="list-group-item">
            <a href="profile_page.html">View Profile</a>
          </li>
        </ul>
      </div>
    </div>
    <div class="row" ng-controller="postController">
      <div class="gedf-main column-main" ng-repeat="data in data">
        </br>
        <div class="card gedf-card" ng-if="data.type=='image'">
          <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex justify-content-between align-items-center">
                <div class="mr-2">
                  <img class="rounded-circle" width="45" src="../IMAGES//sticker.png" n alt="" />
                </div>
                <div class="ml-2">
                  <div class="h5 m-0">@soorya_s_rajan</div>
                  <div class="h7 text-muted">Soorya S Rajan</div>
                </div>
              </div>
              <div>
                <div class="dropdown">
                  <button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    <i class="fa fa-ellipsis-h"></i>
                  </button>
                  <!-- delete button -->
                  <button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1"
                    ng-click="deletePost(data._id, data.type)">
                    <i class="fa fa-trash"></i>
                  </button>
                  <!-- update button -->
                  <button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1"
                    ng-click="updatePost(data._id, data)">
                    <i class="fa fa-edit"></i>
                  </button>
                  <div class="dropdown-menu dropdown-menu-right" aria-labelledby="gedf-drop1">
                    <div class="h6 dropdown-header">Configuration</div>
                    <a class="dropdown-item" href="#">Save</a>
                    <a class="dropdown-item" href="#">Hide</a>
                    <a class="dropdown-item" href="#">Report</a>
                    <a class="dropdown-item" href="#">Contribute</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="text-muted h7 mb-2">
              <i class="fa fa-clock-o"></i>{{data.date}}
            </div>
            <a class="card-link" href="#">
              <h5 class="card-title">
                {{data.title}}
              </h5>
            </a>
            <h5 class="card-subtitle">
              {{data.desc}}
            </h5>
            </br>
            <h6 class="card-subtitle">
              Categoy: {{data.category}}
            </h6>
            </br>
            <h6 class="card-subtitle">
              Contribute: {{data.price}}$
            </h6>
            </br>

            <div class="card-image">
              <img src="http://localhost:4000/uploads/{{data.image}}" class="feed-image" />

            </div>
          </div>
          <div class="card-footer">
            <a href="#" class="card-link"><i class="fa fa-gittip"></i> Like</a>
            <a href="#" class="card-link"><i class="fa fa-comment"></i> Comment</a>
            <a href="#" class="card-link"><i class="fa fa-mail-forward"></i> Share</a>
          </div>
        </div>
        <div class="card gedf-card" ng-if="data.type=='text'">
          <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
              <div class="d-flex justify-content-between align-items-center">
                <div class="mr-2">
                  <img class="rounded-circle" width="45" src="../IMAGES//sticker.png" alt="" />
                </div>
                <div class="ml-2">
                  <div class="h5 m-0">@soorya_s_rajan</div>
                  <div class="h7 text-muted">Soorya S Rajan</div>
                </div>
              </div>
              <div>

                <div class="dropdown">
                  <button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">

                    <i class="fa fa-ellipsis-h"></i>
                  </button>
                  <button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1"
                    ng-click="deletePost(data._id, data.type)">
                    <i class="fa fa-trash"></i>
                  </button>
                  <!-- update button -->
                  <button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1"
                    ng-click="updatePost(data._id, data)">
                    <i class="fa fa-edit"></i>  
                  </button>
                  
                    
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="gedf-drop1">
                      <div class="h6 dropdown-header">Configuration</div>
                      <a class="dropdown-item" href="#">Save</a>
                      <a class="dropdown-item" href="#">Hide</a>
                      <a class="dropdown-item" href="#">Report</a>
                      <a class="dropdown-item" href="#">Contribute</a>
                    </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="text-muted h7 mb-2">
              <i class="fa fa-clock-o"></i> {{data.date}}
            </div>
            <a class="card-link" href="#">
              <h5 class="card-title">
                {{data.title}}
              </h5>
            </a>
            <h5 class="card-subtitle">
              {{data.desc}}
            </h5>
            <h5 class="card-subtitle">
              {{data.desc}}
            </h5>
            </br>
            <h6 class="card-subtitle">
              Categoy: {{data.category}}
            </h6>
            </br>
            <h6 class="card-subtitle">
              Contribute: {{data.price}}$
            </h6>
            </br>

            <p class="card-text">
              {{data.text}}
            </p>
          </div>
          <div class="card-footer">
            <a href="#" class="card-link"><i class="fa fa-gittip"></i> Like</a>
            <a href="#" class="card-link"><i class="fa fa-comment"></i> Comment</a>
            <a href="#" class="card-link"><i class="fa fa-mail-forward"></i> Share</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    var app = angular.module("feedApp", []);
    app.controller("postController", function ($scope, $interval, $http) {
      $scope.data = [];

      var dataCall = function () {
        $http.get("http://localhost:4000/getposts").then(function (data) {
          console.log(data.data.data);
          $scope.data = data.data.data;
        });
        // delete post, type text or image
        $scope.deletePost = function (id, type) {
          $http
            .post("http://localhost:4000/managePosts/deletepost", {
              id: id,
              type: type,
            })
            .then(function (data) {
              console.log(data);
              alert("Deleted successfully")
            });
        };

        // update post, type text or image
        $scope.updatePost = function (id, data) {

          //redirect to update page
          // if type is text, text_form_angular_update.html
          // if type is image, image_form_angular_update.html
          if(data.type == 'text'){
            sessionStorage.textData = JSON.stringify(data);
            window.location.href = "http://localhost:4000/text_form_angular_update.html";
          }else{
            sessionStorage.imageData = JSON.stringify(data); //will set object to the stringified myObject
            window.location.href = "http://localhost:4000/image_form_angular_update.html";
          }
        };

      };

      $interval(dataCall, 1000);
    });
  </script>
</body>

</html>